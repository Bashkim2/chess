{"ast":null,"code":"import _slicedToArray from\"/home/ahmed-bashir/React-projects/chess/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"../../css/Pieces.css\";import Piece from\"./Piece\";import{useRef}from\"react\";import{useAppContext}from\"../../contexts/Context\";import{openPromotion}from\"../../reducer/actions/popup\";import arbiter from\"../../arbiter/arbiter\";import{clearCandidates,makeNewMove}from\"../../reducer/actions/move\";import{getCastlingDirections}from\"../../arbiter/getMoves\";import{detectCheckmate,detectInsufficientMaterial,detectStalemate,updateCastling}from\"../../reducer/actions/game\";import{getNewMoveNotation}from\"../../helpful/helper\";import{jsx as _jsx}from\"react/jsx-runtime\";var Pieces=function Pieces(){var _useAppContext=useAppContext(),appState=_useAppContext.appState,dispatch=_useAppContext.dispatch;var currentPosition=appState.position[appState.position.length-1];var ref=useRef();var updateCastlingState=function updateCastlingState(_ref){var piece=_ref.piece,file=_ref.file,rank=_ref.rank;var direction=getCastlingDirections({castleDirection:appState.castleDirection,piece:piece,file:file,rank:rank});if(direction){dispatch(updateCastling(direction));}};var openPromotionBox=function openPromotionBox(_ref2){var rank=_ref2.rank,file=_ref2.file,x=_ref2.x,y=_ref2.y;dispatch(openPromotion({rank:Number(rank),file:Number(file),x:x,y:y}));};var calculateCoords=function calculateCoords(e){var _ref$current$getBound=ref.current.getBoundingClientRect(),top=_ref$current$getBound.top,left=_ref$current$getBound.left,width=_ref$current$getBound.width;var size=width/8;var y=Math.floor((e.clientX-left)/size);var x=7-Math.floor((e.clientY-top)/size);return{x:x,y:y};};var move=function move(e){var _calculateCoords=calculateCoords(e),x=_calculateCoords.x,y=_calculateCoords.y;var _e$dataTransfer$getDa=e.dataTransfer.getData(\"text\").split(\",\"),_e$dataTransfer$getDa2=_slicedToArray(_e$dataTransfer$getDa,3),piece=_e$dataTransfer$getDa2[0],rank=_e$dataTransfer$getDa2[1],file=_e$dataTransfer$getDa2[2];if(appState.candidateMoves.find(function(m){return m[0]===x&&m[1]===y;})){var opponent=piece.startsWith(\"b\")?\"w\":\"b\";var castleDirection=appState.castleDirection[\"\".concat(piece.startsWith(\"b\")?\"white\":\"black\")];if(piece===\"wp\"&&x===7||piece===\"bp\"&&x===0){openPromotionBox({rank:rank,file:file,x:x,y:y});return;}if(piece.endsWith(\"r\")||piece.endsWith(\"k\")){updateCastlingState({piece:piece,file:file,rank:rank});}var newPosition=arbiter.performMove({position:currentPosition,piece:piece,rank:rank,file:file,x:x,y:y});var newMove=getNewMoveNotation({piece:piece,rank:rank,file:file,x:x,y:y,position:currentPosition});dispatch(makeNewMove({newPosition:newPosition,newMove:newMove}));if(arbiter.insufficientMaterial(newPosition))dispatch(detectInsufficientMaterial());else if(arbiter.isStalemate(newPosition,opponent,castleDirection)){dispatch(detectStalemate());}else if(arbiter.isCheckMate(newPosition,opponent,castleDirection)){dispatch(detectCheckmate(piece[0]));}}dispatch(clearCandidates());};var onDrop=function onDrop(e){e.preventDefault();move(e);};var onDragOver=function onDragOver(e){e.preventDefault();};return/*#__PURE__*/_jsx(\"div\",{className:\"pieces\",ref:ref,onDrop:onDrop,onDragOver:onDragOver,children:currentPosition.map(function(r,rank){return r.map(function(f,file){return currentPosition[rank][file]?/*#__PURE__*/_jsx(Piece,{rank:rank,file:file,piece:currentPosition[rank][file]},rank+\"-\"+file):null;});})});};export default Pieces;","map":{"version":3,"names":["Piece","useRef","useAppContext","openPromotion","arbiter","clearCandidates","makeNewMove","getCastlingDirections","detectCheckmate","detectInsufficientMaterial","detectStalemate","updateCastling","getNewMoveNotation","jsx","_jsx","Pieces","_useAppContext","appState","dispatch","currentPosition","position","length","ref","updateCastlingState","_ref","piece","file","rank","direction","castleDirection","openPromotionBox","_ref2","x","y","Number","calculateCoords","e","_ref$current$getBound","current","getBoundingClientRect","top","left","width","size","Math","floor","clientX","clientY","move","_calculateCoords","_e$dataTransfer$getDa","dataTransfer","getData","split","_e$dataTransfer$getDa2","_slicedToArray","candidateMoves","find","m","opponent","startsWith","concat","endsWith","newPosition","performMove","newMove","insufficientMaterial","isStalemate","isCheckMate","onDrop","preventDefault","onDragOver","className","children","map","r","f"],"sources":["/home/ahmed-bashir/React-projects/chess/src/components/Pieces/Pieces.js"],"sourcesContent":["import \"../../css/Pieces.css\";\nimport Piece from \"./Piece\";\nimport { useRef } from \"react\";\nimport { useAppContext } from \"../../contexts/Context\";\nimport { openPromotion } from \"../../reducer/actions/popup\";\nimport arbiter from \"../../arbiter/arbiter\";\nimport { clearCandidates, makeNewMove } from \"../../reducer/actions/move\";\nimport { getCastlingDirections } from \"../../arbiter/getMoves\";\nimport {\n  detectCheckmate,\n  detectInsufficientMaterial,\n  detectStalemate,\n  updateCastling,\n} from \"../../reducer/actions/game\";\nimport { getNewMoveNotation } from \"../../helpful/helper\";\n\nconst Pieces = () => {\n  const { appState, dispatch } = useAppContext();\n  const currentPosition = appState.position[appState.position.length - 1];\n\n  const ref = useRef();\n\n  const updateCastlingState = ({ piece, file, rank }) => {\n    const direction = getCastlingDirections({\n      castleDirection: appState.castleDirection,\n      piece,\n      file,\n      rank,\n    });\n    if (direction) {\n      dispatch(updateCastling(direction));\n    }\n  };\n\n  const openPromotionBox = ({ rank, file, x, y }) => {\n    dispatch(\n      openPromotion({\n        rank: Number(rank),\n        file: Number(file),\n        x,\n        y,\n      })\n    );\n  };\n\n  const calculateCoords = (e) => {\n    const { top, left, width } = ref.current.getBoundingClientRect();\n    const size = width / 8;\n    const y = Math.floor((e.clientX - left) / size);\n    const x = 7 - Math.floor((e.clientY - top) / size);\n\n    return { x, y };\n  };\n\n  const move = (e) => {\n    const { x, y } = calculateCoords(e);\n    const [piece, rank, file] = e.dataTransfer.getData(\"text\").split(\",\");\n\n    if (appState.candidateMoves.find((m) => m[0] === x && m[1] === y)) {\n      const opponent = piece.startsWith(\"b\") ? \"w\" : \"b\";\n      const castleDirection =\n        appState.castleDirection[\n          `${piece.startsWith(\"b\") ? \"white\" : \"black\"}`\n        ];\n\n      if ((piece === \"wp\" && x === 7) || (piece === \"bp\" && x === 0)) {\n        openPromotionBox({ rank, file, x, y });\n        return;\n      }\n      if (piece.endsWith(\"r\") || piece.endsWith(\"k\")) {\n        updateCastlingState({ piece, file, rank });\n      }\n      const newPosition = arbiter.performMove({\n        position: currentPosition,\n        piece,\n        rank,\n        file,\n        x,\n        y,\n      });\n      const newMove = getNewMoveNotation({\n        piece,\n        rank,\n        file,\n        x,\n        y,\n        position: currentPosition,\n      });\n      dispatch(makeNewMove({ newPosition, newMove }));\n\n      if (arbiter.insufficientMaterial(newPosition))\n        dispatch(detectInsufficientMaterial());\n      else if (arbiter.isStalemate(newPosition, opponent, castleDirection)) {\n        dispatch(detectStalemate());\n      } else if (arbiter.isCheckMate(newPosition, opponent, castleDirection)) {\n        dispatch(detectCheckmate(piece[0]));\n      }\n    }\n    dispatch(clearCandidates());\n  };\n\n  const onDrop = (e) => {\n    e.preventDefault();\n\n    move(e);\n  };\n\n  const onDragOver = (e) => {\n    e.preventDefault();\n  };\n\n  return (\n    <div className=\"pieces\" ref={ref} onDrop={onDrop} onDragOver={onDragOver}>\n      {currentPosition.map((r, rank) =>\n        r.map((f, file) =>\n          currentPosition[rank][file] ? (\n            <Piece\n              key={rank + \"-\" + file}\n              rank={rank}\n              file={file}\n              piece={currentPosition[rank][file]}\n            />\n          ) : null\n        )\n      )}\n    </div>\n  );\n};\n\nexport default Pieces;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}